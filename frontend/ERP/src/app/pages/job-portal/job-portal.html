<div class="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100">
    <!-- Header Section -->
    <div class="bg-gradient-to-r from-blue-600 to-indigo-600 text-white py-12 px-4">
        <div class="max-w-7xl mx-auto">
            <div class="flex align-items-center gap-4 mb-4">
                <i class="pi pi-briefcase text-4xl"></i>
                <h1 class="text-4xl font-bold m-0">Join Our Team</h1>
            </div>
            <p class="text-blue-100 text-lg m-0">
                Explore exciting opportunities and grow your career with us
            </p>
        </div>
    </div>

    <!-- Main Content -->
    <div class="max-w-7xl mx-auto p-4 md:p-6">
        <!-- Loading State -->
        @if(isLoading) {
        <div class="flex align-items-center justify-content-center py-12">
            <i class="pi pi-spin pi-spinner text-primary text-4xl"></i>
        </div>
        }

        <!-- Empty State -->
        @if(jobPosts.length === 0 && !isLoading) {
        <div class="flex flex-column align-items-center justify-content-center py-12 px-4">
            <div
                class="bg-blue-50 border-circle w-8rem h-8rem flex align-items-center justify-content-center mb-4"
            >
                <i class="pi pi-inbox text-6xl text-blue-400"></i>
            </div>
            <h3 class="text-2xl font-bold text-900 mb-2">No Open Positions</h3>
            <p class="text-600 text-lg text-center max-w-30rem">
                There are currently no open positions available. Please check back later for new
                opportunities!
            </p>
        </div>
        }

        <!-- Job Posts Grid -->
        @if(jobPosts.length > 0 && !isLoading) {
        <div class="grid gap-4 md:gap-6">
            @for(jobPost of jobPosts; track jobPost.id) {
            <div
                class="bg-white rounded-lg shadow-md hover:shadow-xl transition-all duration-300 p-6"
            >
                <div class="flex flex-column gap-4">
                    <!-- Job Header -->
                    <div class="flex align-items-start justify-content-between gap-4">
                        <div class="flex-grow-1">
                            <h2 class="text-2xl font-bold text-900 m-0 mb-2">
                                {{ jobPost.title }}
                            </h2>
                            <p class="text-600 m-0">
                                <i class="pi pi-calendar mr-2"></i>Posted on
                                {{ formatDate(jobPost.postedAt) }}
                            </p>
                        </div>
                        <p-tag value="Open" severity="success"></p-tag>
                    </div>

                    <!-- Description -->
                    <div>
                        <p class="text-900 line-height-1_6 m-0">{{ jobPost.description }}</p>
                    </div>

                    <!-- Requirements -->
                    @if(jobPost.requirements && jobPost.requirements.length > 0) {
                    <div>
                        <h4 class="text-900 font-semibold mb-3">Requirements</h4>
                        <ul class="m-0 pl-4">
                            @for(req of jobPost.requirements; track $index) {
                            <li class="mb-2 text-600">
                                <span>{{ req.text }}</span>
                                @if(req.mandatory) {
                                <p-tag value="Mandatory" severity="danger" class="ml-2"></p-tag>
                                }
                            </li>
                            }
                        </ul>
                    </div>
                    }

                    <!-- Apply Button -->
                    <div class="flex justify-content-end pt-4 border-top-1 border-surface-border">
                        <p-button
                            label="Apply Now"
                            icon="pi pi-send"
                            severity="success"
                            (onClick)="openApplicationModal(jobPost)"
                        ></p-button>
                    </div>
                </div>
            </div>
            }
        </div>
        }
    </div>

    <!-- Application Modal -->
    <p-dialog
        [(visible)]="showApplicationModal"
        [header]="'Apply for: ' + (selectedJob?.title || '')"
        [modal]="true"
        [style]="{ width: '90vw', maxWidth: '600px' }"
        [draggable]="false"
        [resizable]="false"
        (onHide)="closeApplicationModal()"
    >
        <div class="grid gap-4">
            <!-- First Name -->
            <div class="col-12 md:col-6">
                <label for="firstName" class="block text-900 font-semibold mb-2">
                    <i class="pi pi-user mr-2 text-primary"></i>First Name
                    <span class="text-red-500">*</span>
                </label>
                <input
                    id="firstName"
                    type="text"
                    pInputText
                    [(ngModel)]="applicationForm.firstName"
                    placeholder="Enter your first name"
                    class="w-full"
                />
            </div>

            <!-- Last Name -->
            <div class="col-12 md:col-6">
                <label for="lastName" class="block text-900 font-semibold mb-2">
                    <i class="pi pi-user mr-2 text-primary"></i>Last Name
                    <span class="text-red-500">*</span>
                </label>
                <input
                    id="lastName"
                    type="text"
                    pInputText
                    [(ngModel)]="applicationForm.lastName"
                    placeholder="Enter your last name"
                    class="w-full"
                />
            </div>

            <!-- Email -->
            <div class="col-12">
                <label for="email" class="block text-900 font-semibold mb-2">
                    <i class="pi pi-envelope mr-2 text-primary"></i>Email
                    <span class="text-red-500">*</span>
                </label>
                <input
                    id="email"
                    type="email"
                    pInputText
                    [(ngModel)]="applicationForm.email"
                    placeholder="Enter your email address"
                    class="w-full"
                />
            </div>

            <!-- CV File Upload with Drag and Drop -->
            <div class="col-12">
                <label class="block text-900 font-semibold mb-2">
                    <i class="pi pi-file mr-2 text-primary"></i>Upload CV/Resume
                    <span class="text-red-500">*</span>
                </label>
                
                <!-- Drag and Drop Area -->
                <div
                    class="border-2 border-dashed border-400 rounded-lg p-6 text-center cursor-pointer transition-all duration-200"
                    [class.border-primary]="isDragOver"
                    [class.bg-blue-50]="isDragOver"
                    (dragover)="onDragOver($event)"
                    (dragleave)="onDragLeave($event)"
                    (drop)="onDrop($event)"
                >
                    @if(!applicationForm.cvFileName) {
                    <div class="flex flex-column align-items-center gap-3">
                        <i class="pi pi-cloud-upload text-4xl text-400"></i>
                        <div>
                            <p class="text-900 font-semibold m-0">Drag and drop your CV here</p>
                            <small class="text-600">or click to select a file</small>
                        </div>
                        <input
                            #fileInput
                            type="file"
                            accept=".pdf,.docx"
                            (change)="onFileSelected($event)"
                            class="hidden"
                        />
                        <p-button
                            label="Browse Files"
                            icon="pi pi-folder-open"
                            (onClick)="fileInput.click()"
                            severity="info"
                            [text]="true"
                        ></p-button>
                    </div>
                    } @else {
                    <div class="flex align-items-center justify-content-between gap-3 bg-green-50 p-4 rounded-lg border-1 border-green-200">
                        <div class="flex align-items-center gap-3">
                            <i class="pi pi-check-circle text-2xl text-green-600"></i>
                            <div class="text-left">
                                <p class="text-900 font-semibold m-0">{{ applicationForm.cvFileName }}</p>
                                <small class="text-600">File uploaded successfully</small>
                            </div>
                        </div>
                        <p-button
                            icon="pi pi-trash"
                            [rounded]="true"
                            [text]="true"
                            severity="danger"
                            (onClick)="removeCvFile()"
                        ></p-button>
                    </div>
                    }
                </div>
                <small class="text-600 block mt-2">
                    Accepted formats: PDF, DOCX (Max 10MB)
                </small>
            </div>

            <!-- Cover Letter -->
            <div class="col-12">
                <label for="coverLetter" class="block text-900 font-semibold mb-2">
                    <i class="pi pi-book mr-2 text-primary"></i>Cover Letter
                    <span class="text-red-500">*</span>
                </label>
                <textarea
                    id="coverLetter"
                    pInputTextarea
                    [(ngModel)]="applicationForm.coverLetter"
                    placeholder="Tell us why you're a great fit for this position"
                    rows="5"
                    class="w-full"
                ></textarea>
                <small class="text-600 block mt-1">
                    {{ applicationForm.coverLetter.length }}/1000 characters
                </small>
            </div>
        </div>

        <ng-template pTemplate="footer">
            <div class="flex gap-2 justify-content-end">
                <p-button
                    label="Cancel"
                    icon="pi pi-times"
                    severity="secondary"
                    (onClick)="closeApplicationModal()"
                ></p-button>
                <p-button
                    label="Submit Application"
                    icon="pi pi-check"
                    severity="success"
                    (onClick)="submitApplication()"
                ></p-button>
            </div>
        </ng-template>
    </p-dialog>
</div>

<ngx-spinner
    bdColor="rgba(0, 0, 0, 0.8)"
    size="large"
    color="#ffd700"
    type="timer"
    [fullScreen]="true"
>
    <p style="color: #ffd700">Loading...</p>
</ngx-spinner>

<p-toast position="top-center" />
