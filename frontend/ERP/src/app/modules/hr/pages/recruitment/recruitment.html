<div class="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-4 md:p-6">
    <div class="max-w-7xl mx-auto">
        <!-- Job Requisitions Card -->
        <p-card class="shadow-4 border-round-2xl">
            <ng-template pTemplate="header">
                <div class="bg-gradient-to-r from-blue-600 to-indigo-600 p-5 border-round-top-2xl">
                    <div class="flex align-items-center justify-content-between">
                        <div class="flex align-items-center gap-3">
                            <i class="pi pi-briefcase text-white text-3xl"></i>
                            <div>
                                <h2 class="text-white text-3xl font-bold m-0">Job Requisitions</h2>
                                <p class="text-blue-100 text-sm m-0 mt-1">
                                    Create and manage job requisitions for hiring
                                </p>
                            </div>
                        </div>
                        <p-button
                            label="New Requisition"
                            icon="pi pi-plus"
                            severity="primary"
                            (onClick)="openCreateModal()"
                        ></p-button>
                    </div>
                </div>
            </ng-template>

            <!-- Summary Stats -->
            <div class="grid gap-4 p-4" *ngIf="requisitions.length > 0">
                <div class="col-12 md:col-3">
                    <div class="p-4 bg-blue-50 border-round-lg">
                        <div class="flex align-items-center justify-content-between">
                            <div>
                                <p class="text-600 text-sm m-0">Total Requisitions</p>
                                <p class="text-3xl font-bold text-900 m-0">
                                    {{ requisitions.length }}
                                </p>
                            </div>
                            <i class="pi pi-list text-4xl text-blue-500 opacity-50"></i>
                        </div>
                    </div>
                </div>
                <div class="col-12 md:col-3">
                    <div class="p-4 bg-orange-50 border-round-lg">
                        <div class="flex align-items-center justify-content-between">
                            <div>
                                <p class="text-600 text-sm m-0">Pending</p>
                                <p class="text-3xl font-bold text-900 m-0">
                                    {{ getPendingCount() }}
                                </p>
                            </div>
                            <i class="pi pi-clock text-4xl text-orange-500 opacity-50"></i>
                        </div>
                    </div>
                </div>
                <div class="col-12 md:col-3">
                    <div class="p-4 bg-green-50 border-round-lg">
                        <div class="flex align-items-center justify-content-between">
                            <div>
                                <p class="text-600 text-sm m-0">Approved</p>
                                <p class="text-3xl font-bold text-900 m-0">
                                    {{ getApprovedCount() }}
                                </p>
                            </div>
                            <i class="pi pi-check text-4xl text-green-500 opacity-50"></i>
                        </div>
                    </div>
                </div>
                <div class="col-12 md:col-3">
                    <div class="p-4 bg-red-50 border-round-lg">
                        <div class="flex align-items-center justify-content-between">
                            <div>
                                <p class="text-600 text-sm m-0">Total Openings</p>
                                <p class="text-3xl font-bold text-900 m-0">
                                    {{ getTotalOpenings() }}
                                </p>
                            </div>
                            <i class="pi pi-users text-4xl text-red-500 opacity-50"></i>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Divider -->
            <hr class="m-0" *ngIf="requisitions.length > 0" />

            <!-- Requisitions Table Section -->
            <div class="p-4">
                <!-- Empty State -->
                @if(requisitions.length === 0 && !isLoading) {
                <div
                    class="flex flex-column align-items-center justify-content-center py-8 px-4 text-center"
                >
                    <div
                        class="bg-indigo-50 border-circle w-8rem h-8rem flex align-items-center justify-content-center mb-4"
                    >
                        <i class="pi pi-inbox text-6xl text-indigo-400"></i>
                    </div>
                    <h3 class="text-2xl font-bold text-900 mb-2">No Requisitions Yet</h3>
                    <p class="text-600 text-lg mb-4 max-w-30rem">
                        You haven't created any job requisitions yet. Create one to start the hiring
                        process.
                    </p>
                </div>
                } @else if(isLoading) {
                <div class="flex align-items-center justify-content-center py-6">
                    <i class="pi pi-spin pi-spinner text-primary text-4xl"></i>
                </div>
                } @else {
                <p-table
                    [value]="requisitions"
                    [rows]="10"
                    [paginator]="true"
                    responsiveLayout="scroll"
                    [globalFilterFields]="['reason', 'status', 'priority']"
                    styleClass="p-datatable-striped"
                >
                    <ng-template pTemplate="header">
                        <tr>
                            <th pSortableColumn="id" style="width: 5%">
                                ID <p-sortIcon field="id"></p-sortIcon>
                            </th>
                            <th pSortableColumn="reason" style="width: 35%">
                                Reason <p-sortIcon field="reason"></p-sortIcon>
                            </th>
                            <th pSortableColumn="departmentId" style="width: 15%">
                                Department <p-sortIcon field="departmentId"></p-sortIcon>
                            </th>
                            <th pSortableColumn="openings" style="width: 10%; text-align: center">
                                Openings <p-sortIcon field="openings"></p-sortIcon>
                            </th>
                            <th pSortableColumn="priority" style="width: 12%">
                                Priority <p-sortIcon field="priority"></p-sortIcon>
                            </th>
                            <th pSortableColumn="status" style="width: 12%">
                                Status <p-sortIcon field="status"></p-sortIcon>
                            </th>
                            <th pSortableColumn="createdAt" style="width: 11%">
                                Created <p-sortIcon field="createdAt"></p-sortIcon>
                            </th>
                            <th style="width: 12%; text-align: center">Actions</th>
                        </tr>
                    </ng-template>
                    <ng-template pTemplate="body" let-requisition>
                        <tr>
                            <td class="font-bold text-primary">{{ requisition.id }}</td>
                            <td>
                                <div class="flex flex-column">
                                    <span class="font-semibold text-900">{{
                                        requisition.reason
                                    }}</span>
                                </div>
                            </td>
                            <td>
                                <span class="text-600">{{
                                    getDepartmentName(requisition.departmentId)
                                }}</span>
                            </td>
                            <td style="text-align: center">
                                <p-tag
                                    [value]="requisition.openings + ' position(s)'"
                                    severity="info"
                                ></p-tag>
                            </td>
                            <td>
                                <p-tag
                                    [value]="getPriorityOptions(requisition.priority).label"
                                    [severity]="getPriorityOptions(requisition.priority).severity"
                                ></p-tag>
                            </td>
                            <td>
                                <p-tag
                                    [value]="getStatusOptions(requisition.status).label"
                                    [severity]="getStatusOptions(requisition.status).severity"
                                ></p-tag>
                            </td>
                            <td>
                                <small class="text-600">{{
                                    formatDate(requisition.createdAt)
                                }}</small>
                            </td>
                            <td style="text-align: center">
                                @if(isHRManager() && requisition.status === 'PENDING') {
                                <div class="flex gap-2 justify-content-center">
                                    <p-button
                                        icon="pi pi-check"
                                        [rounded]="true"
                                        [text]="true"
                                        severity="success"
                                        (onClick)="approveRequisition(requisition)"
                                        pTooltip="Approve this requisition"
                                        tooltipPosition="top"
                                    ></p-button>
                                    <p-button
                                        icon="pi pi-times"
                                        [rounded]="true"
                                        [text]="true"
                                        severity="danger"
                                        (onClick)="rejectRequisition(requisition)"
                                        pTooltip="Reject this requisition"
                                        tooltipPosition="top"
                                    ></p-button>
                                </div>
                                } @else if(requisition.status === 'APPROVED') {
                                <div class="flex gap-2 justify-content-center">
                                    <p-button
                                        icon="pi pi-plus"
                                        [rounded]="true"
                                        [text]="true"
                                        severity="info"
                                        (onClick)="navigateToJobPost(requisition.id)"
                                        pTooltip="Create or view job post"
                                        tooltipPosition="top"
                                    ></p-button>
                                </div>
                                }
                            </td>
                        </tr>
                    </ng-template>
                    <ng-template pTemplate="emptymessage">
                        <tr>
                            <td colspan="8" class="text-center py-4">
                                <i class="pi pi-inbox text-3xl text-400 mb-3 block"></i>
                                <p class="text-600">No requisitions found</p>
                            </td>
                        </tr>
                    </ng-template>
                </p-table>
                }
            </div>
        </p-card>
    </div>

    <!-- Create Requisition Modal -->
    <p-dialog
        [(visible)]="showCreateModal"
        [header]="'Create New Job Requisition'"
        [modal]="true"
        [style]="{ width: '90vw', maxWidth: '600px' }"
        [draggable]="false"
        [resizable]="false"
        (onHide)="closeCreateModal()"
    >
        <div class="grid gap-4">
            <!-- Reason -->
            <div class="col-12">
                <label for="reason" class="block text-900 font-semibold mb-2">
                    <i class="pi pi-pencil mr-2 text-primary"></i>Reason / Description
                    <span class="text-red-500">*</span>
                </label>
                <textarea
                    id="reason"
                    pInputTextarea
                    [(ngModel)]="newRequisition.reason"
                    placeholder="Describe the reason for this job requisition (min 10, max 500 characters)"
                    rows="4"
                    class="w-full"
                    [attr.aria-label]="'Requisition reason'"
                ></textarea>
                <small class="text-600 block mt-1">
                    {{ newRequisition.reason.length }}/500 characters
                </small>
            </div>

            <!-- Priority -->
            <div class="col-12">
                <label for="priority" class="block text-900 font-semibold mb-2">
                    <i class="pi pi-flag mr-2 text-primary"></i>Priority
                    <span class="text-red-500">*</span>
                </label>
                <p-select
                    id="priority"
                    [options]="priorityOptions"
                    [(ngModel)]="newRequisition.priority"
                    placeholder="Select priority level"
                    styleClass="w-full"
                    optionLabel="label"
                    optionValue="value"
                >
                    <ng-template pTemplate="selectedItem" let-option>
                        <div class="flex align-items-center gap-2" *ngIf="option">
                            <p-tag
                                [value]="option.label"
                                [severity]="getPriorityOptions(option).severity"
                            ></p-tag>
                        </div>
                    </ng-template>
                    <ng-template pTemplate="item" let-option>
                        <div class="flex align-items-center gap-2 w-full">
                            <p-tag [value]="option.label" [severity]="option.severity"></p-tag>
                        </div>
                    </ng-template>
                </p-select>
            </div>

            <!-- Department -->
            <div class="col-12 md:col-6">
                <label for="department" class="block text-900 font-semibold mb-2">
                    <i class="pi pi-building mr-2 text-primary"></i>Department
                    <span class="text-red-500">*</span>
                </label>
                <p-select
                    id="department"
                    [options]="dropDownDepartments"
                    [(ngModel)]="newRequisition.departmentId"
                    placeholder="Select a department"
                    class="w-full"
                    [showClear]="true"
                >
                    <ng-template pTemplate="selectedItem" let-option>
                        <div class="flex align-items-center gap-2" *ngIf="option">
                            <i class="pi pi-building"></i>
                            <span>{{ option.label }}</span>
                        </div>
                    </ng-template>
                    <ng-template pTemplate="item" let-option>
                        <div class="flex align-items-center gap-2">
                            <i class="pi pi-building"></i>
                            <span>{{ option.label }}</span>
                        </div>
                    </ng-template>
                </p-select>
            </div>

            <!-- Number of Openings -->
            <div class="col-12 md:col-6">
                <label for="openings" class="block text-900 font-semibold mb-2">
                    <i class="pi pi-users mr-2 text-primary"></i>Number of Openings
                    <span class="text-red-500">*</span>
                </label>
                <p-inputNumber
                    id="openings"
                    [(ngModel)]="newRequisition.openings"
                    [min]="1"
                    [max]="100"
                    placeholder="Enter number of openings"
                    styleClass="w-full"
                ></p-inputNumber>
            </div>
        </div>

        <ng-template pTemplate="footer">
            <div class="flex gap-2 justify-content-end">
                <p-button
                    label="Cancel"
                    icon="pi pi-times"
                    severity="secondary"
                    (onClick)="closeCreateModal()"
                ></p-button>
                <p-button
                    label="Create Requisition"
                    icon="pi pi-check"
                    severity="success"
                    (onClick)="submitRequisition()"
                    [loading]="isLoading"
                ></p-button>
            </div>
        </ng-template>
    </p-dialog>
</div>

<ngx-spinner
    bdColor="rgba(0, 0, 0, 0.8)"
    size="large"
    color="#ffd700"
    type="timer"
    [fullScreen]="true"
>
    <p style="color: #ffd700">Loading requisitions...</p>
</ngx-spinner>

<p-toast position="top-center" />
